package test;

import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Formatter;

import org.testng.annotations.Test;

import listener.annotation.Xray;
import page.models.OrdonnancePDF;
import page.models.PageAccueil;
import page.models.PageConnexion;
import page.models.PageDossierAdministratif;
import page.models.PageDossierMedical;
import page.models.PageDossierPatients;
import page.models.PageListePatient;
import page.models.PageTraitements;
import page.models.PageTraitementsComplementaires;
import page.models.TextEditorPage;
import page.module.ModuleAjoutProduits;
import page.module.ModuleSaisieRapideBiometrie;

public class CQ_1117_TxtCtrl_Utilisation_de_l_éditeur_de_texte_depuis_la_Prescription_Medicamenteuse extends BaseTest{
	String color_gris = "rgba(124, 124, 124, 1)";
	String color_vert = "rgba(0, 213, 0, 1)";
	LocalDateTime date = LocalDateTime.now();
	DateTimeFormatter formatter =  DateTimeFormatter.ofPattern("dd/MM/yy");
	DateTimeFormatter formatter2 =  DateTimeFormatter.ofPattern("dd/MM/yyyy");
	String DATE_DE_JOUR = formatter.format(date);
	String DATE_DE_JOUR2 = formatter2.format(date);
	
	@Test
	@Xray(test="CQ-1117")
	public void TxtCtrl_Utilisation_d_un_modèle_crée() throws InterruptedException {
		PageConnexion pageConnexion = new PageConnexion();
		PageAccueil pageAccueil = new PageAccueil();
		pageConnexion.seConnecterParLoginEtMotDePasse();
		pageAccueil.accepterNoteCentre();
		pageAccueil.ouvrirMenuDeGauche("Dossier Patients");
		PageDossierPatients pageDossierPatients = new PageDossierPatients();
		pageDossierPatients.créerNouveauDossier();
		PageDossierAdministratif pageDossierAdministratif = new PageDossierAdministratif();
		pageDossierAdministratif.recueilDuConsentementDuPatient();
		String nomPatient = pageDossierAdministratif.renseignerNom("TEXTCTRL");
		pageDossierAdministratif.renseignerNomDeNaissance("TEXTCTRL");
		pageDossierAdministratif.renseignerPrenom("CQ1117");
		pageDossierAdministratif.choisirSexe("Masculin");
		pageDossierAdministratif.renseignerLocalitDeNaissance("paris");
		pageDossierAdministratif.renseignerDateDeNaissance("29/4/1990");
		pageDossierAdministratif.validerCreationNouveauDossier();
		Thread.sleep(2000);
		pageDossierAdministratif.validerCriteresDeVerification();
		PageListePatient pageListePatients = new PageListePatient();
		pageDossierPatients = new PageDossierPatients();
		pageDossierPatients.retourAccueil();
		pageAccueil.rechercherLePatientAvecLeNomEtOuvrirSonDossierMedical(nomPatient);
		PageDossierMedical pageDossierMedical = new PageDossierMedical();
		pageDossierMedical.prescrireMedicaments();
		PageTraitements pageTraitements = new PageTraitements();
		//pageTraitements.optionImpressionEtValidationSansRetourDossierMedical();
		pageTraitements.commencerNouveauTraitement();
		ModuleAjoutProduits moduleAjoutProduits = new ModuleAjoutProduits();
		moduleAjoutProduits.rechercherUnProduit("FUCIDINE");
		moduleAjoutProduits.ajouterProduitAvecPosologieUsuell();
		moduleAjoutProduits.fermerModuleAjoutProduit();
		pageTraitements.accepterEtImprimerOrdonnance();
	
		pageTraitements.switchTowindow(1);
		TextEditorPage textEditorPage = new TextEditorPage();
		textEditorPage.saisie_des_informations_dans_le_pdf("CQ-1117");
		textEditorPage.valider_et_ouvrir_le_document();	
		OrdonnancePDF ordonnancePDF = new OrdonnancePDF();
		ordonnancePDF.readpdfItext("FUCIDINE");
		ordonnancePDF.readpdfItext("CQ-1117");
		ordonnancePDF.switchTowindow(0);
		//pageDossierMedical.prescrireMedicaments();
		pageTraitements.commencerNouveauTraitement();
        moduleAjoutProduits = new ModuleAjoutProduits();
		moduleAjoutProduits.rechercherUnProduit("DOLIPRANE");
		moduleAjoutProduits.ajouterProduitAvecPosologieUsuell();
		moduleAjoutProduits.fermerModuleAjoutProduit();
		pageTraitements.accepterEtImprimerOrdonnance();
		Thread.sleep(10000);
		pageTraitements.switchTowindow(1);
		textEditorPage.verifierContenuDansLeTextEditor("DOLIPRANE");
		textEditorPage.valider_et_retour_le_document();
		textEditorPage.switchTowindow(0);
		//pageDossierMedical.prescrireMedicaments();
		pageTraitements.commencerNouveauTraitement();
        moduleAjoutProduits = new ModuleAjoutProduits();
		moduleAjoutProduits.rechercherUnProduit("HAVLANE");
		moduleAjoutProduits.ouvrirChoixDeLaPosologie("HAVLANE");
		moduleAjoutProduits.editerPosologie("Traitement symptomatique");
		moduleAjoutProduits.deactiverOptionALD();
		moduleAjoutProduits.prescrire_et_fermer();
		pageTraitements.verifier_status_ALD(color_gris,"HAVLANE");
		pageTraitements.Activer_ALD_dans_l_ordonnance("HAVLANE");
		pageTraitements.verifier_status_ALD(color_vert,"HAVLANE");
		//moduleAjoutProduits.activerOptionALD()
		pageTraitements.commencerNouveauTraitement();
        moduleAjoutProduits = new ModuleAjoutProduits();
    	moduleAjoutProduits.rechercherUnProduit("LODOZ 10MG");
		moduleAjoutProduits.ouvrirChoixDeLaPosologie("LODOZ 10 mg");
		moduleAjoutProduits.editerPosologie("1 comprimé le matin à avaler sans mâcher avec un peu de liquide.");
		moduleAjoutProduits.deactiverOptionALD();
		moduleAjoutProduits.prescrire_et_fermer();
		pageTraitements.verifier_status_ALD(color_gris,"LODOZ");
		pageTraitements.accepterEtImprimerOrdonnance();
		pageTraitements.switchTowindow(1);
		textEditorPage = new TextEditorPage();
		textEditorPage.valider_et_ouvrir_le_document();
		ordonnancePDF.readpdfItext("HAVLANE Prescriptions relatives au traitement de l´affection de longue durée reconnue");
		ordonnancePDF.readpdfItext("LODOZ Prescriptions SANS RAPPORT avec l´affection de longue durée]");
		ordonnancePDF.switchTowindow(0);
		//pageDossierMedical.prescrireMedicaments();
		pageTraitements.commencerNouveauTraitement();
        moduleAjoutProduits = new ModuleAjoutProduits();
		moduleAjoutProduits.rechercherUnProduit("EFFERALGAN");
		moduleAjoutProduits.ouvrirChoixDeLaPosologie("EFFERALGAN");
		moduleAjoutProduits.editerPosologie("1 comprimé 1 à 3 fois par jour selon besoin, en espaçant les prises de 4h minimum.");
		moduleAjoutProduits.activerOptionALD();
		moduleAjoutProduits.prescrire_et_fermer();
		pageTraitements.verifier_status_ALD(color_vert,"EFFERALGAN");
		pageTraitements.accepterEtImprimerOrdonnance();
		pageTraitements.switchTowindow(1);
		textEditorPage = new TextEditorPage();
		textEditorPage.valider_et_ouvrir_le_document();
		ordonnancePDF.readpdfItext("Prescriptions relatives au traitement de l´affection de longue durée reconnue");
		ordonnancePDF.readpdfItext("EFFERALGAN Prescriptions SANS RAPPORT avec l´affection de longue durée]");
		textEditorPage.switchTowindow(0);
		//pageDossierMedical.prescrireMedicaments();
		pageTraitements.commencerNouveauTraitement();
        moduleAjoutProduits = new ModuleAjoutProduits();
		moduleAjoutProduits.rechercherUnProduit("EFFERALGAN");
		moduleAjoutProduits.ouvrirChoixDeLaPosologie("EFFERALGAN");
		moduleAjoutProduits.editerPosologie("1 comprimé 1 à 3 fois par jour selon besoin, en espaçant les prises de 4h minimum.");
		moduleAjoutProduits.deactiverOptionNepasdelivrer();
		//moduleAjoutProduits.deactiverOptionSubstituable();
		moduleAjoutProduits.prescrire_et_fermer();
		pageTraitements.verifier_status_Nepasdelivrer(color_gris,"EFFERALGAN");
		pageTraitements.verifier_status_Substituable(color_gris,"EFFERALGAN");
		pageTraitements.Activer_Nepasdelivrer_dans_l_ordonnance("EFFERALGAN");
		pageTraitements.verifier_status_Nepasdelivrer(color_vert,"EFFERALGAN");
		pageTraitements.Activer_Substituable_dans_l_ordonnance("EFFERALGAN");
		pageTraitements.verifier_status_Substituable(color_vert,"EFFERALGAN");
		pageTraitements.accepterEtImprimerOrdonnance();
		pageTraitements.switchTowindow(1);
		textEditorPage = new TextEditorPage();
		textEditorPage.valider_et_ouvrir_le_document();
		ordonnancePDF.readpdfItext("EFFERALGAN");
		textEditorPage.switchTowindow(0);
		pageTraitements.retourDossierMedical();
		pageDossierMedical.verifierQueLaPrescriptionMedicamenteuseEstBienAjouteeDansLeDossierMedical("EFFERALGAN",DATE_DE_JOUR);
		pageDossierMedical.verifierQueLaPrescriptionMedicamenteuseEstBienAjouteeDansLeDossierMedical("LODOZ",DATE_DE_JOUR);
	    pageDossierMedical.ouvrirPrescriptionsMedicamenteuse("LODOZ",DATE_DE_JOUR);
	    pageTraitements.verifierPresenceOrdonnanceDansHistorique();
	    pageTraitements.imprimerOrdonnanceDepuisHistorique(DATE_DE_JOUR2,"LODOZ");
	    pageTraitements.switchTowindow(1);
	    ordonnancePDF = new OrdonnancePDF();
	    ordonnancePDF.readpdfItext("LODOTZ");
	    ordonnancePDF.switchTowindow(0);
	    pageTraitements.imprimerDuplicataDepuisHistorique(DATE_DE_JOUR2,"LODOZ");
	    pageTraitements.switchTowindow(1);
	    ordonnancePDF.readpdfItext("Duplicata");
	    ordonnancePDF.switchTowindow(0);
	    pageTraitements.optionImpressionEtValidationRetourDossierMedical();
	    pageTraitements.commencerNouveauTraitement();
        moduleAjoutProduits = new ModuleAjoutProduits();
		moduleAjoutProduits.rechercherUnProduit("EFFERALGAN");
		moduleAjoutProduits.ouvrirChoixDeLaPosologie("EFFERALGAN");
		moduleAjoutProduits.editerPosologie("1 comprimé 1 à 3 fois par jour selon besoin, en espaçant les prises de 4h minimum.");
		moduleAjoutProduits.prescrire_et_fermer();
		pageTraitements.accepterEtImprimerOrdonnance();
		pageTraitements.switchTowindow(2);
		textEditorPage = new TextEditorPage();
		textEditorPage.valider_et_ouvrir_le_document();
	    ordonnancePDF.readpdfItext("Duplicata");
	}
}